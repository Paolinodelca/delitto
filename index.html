<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Delitto in Villa – Interrogatorio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        #suspects {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        .suspect-btn {
            padding: 12px 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        #chat {
            width: 100%;
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            min-height: 300px;
        }
        #inputBox {
            display: flex;
            margin-top: 10px;
        }
        #userInput {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }
        #sendBtn {
            padding: 10px 15px;
            margin-left: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
    </style>
</head>

<body>
<h1>Delitto in Villa – Interrogatorio</h1>

<div id="suspects">
    <button class="suspect-btn" onclick="selectSuspect('contessa')">Contessa Bianca</button>
    <button class="suspect-btn" onclick="selectSuspect('maggiordomo')">Maggiordomo Alfredo</button>
    <button class="suspect-btn" onclick="selectSuspect('cugina')">Cugina Viola</button>
</div>

<div id="chat">
    <p><i>Scegli un sospettato e inizia l'interrogatorio...</i></p>
</div>

<div id="inputBox">
    <input id="userInput" type="text" placeholder="Scrivi una domanda...">
    <button id="sendBtn" onclick="sendMessage()">Invia</button>
</div>

<script>
let API_KEY = "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";
let currentSuspect = null;

const profiles = {
    "contessa": "Tu sei la Contessa Bianca, elegante, aristocratica, molto attenta a non farti accusare. Devi sempre apparire calma e superiore, e mentire con grazia quando serve.",
    "maggiordomo": "Tu sei Alfredo, il maggiordomo. Sei nervoso e ansioso, temi di essere sospettato e ogni tanto ti contraddici. Cerchi di sembrare innocente.",
    "cugina": "Tu sei Viola, la cugina ribelle. Sei impulsiva, emotiva, e nascondi molte cose. Rispondi in modo teatrale e drammatico."
};

function selectSuspect(suspect) {
    currentSuspect = suspect;
    document.getElementById("chat").innerHTML = `<b>Stai interrogando: ${suspect.toUpperCase()}</b><br><br>`;
}

async function sendMessage() {
    if (!currentSuspect) {
        alert("Prima scegli un sospettato!");
        return;
    }

    const question = document.getElementById("userInput").value;
    if (!question.trim()) return;

    const chatBox = document.getElementById("chat");
    chatBox.innerHTML += `<p><b>Tu:</b> ${question}</p>`;

    document.getElementById("userInput").value = "";

    // Chiamata API a Groq
    const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${API_KEY}`
        },
        body: JSON.stringify({
            model: "llama-3.1-8b-instant",
            messages: [
                { role: "system", content: profiles[currentSuspect] },
                { role: "user", content: question }
            ]
        })
    });

    const data = await response.json();
    const answer = data.choices[0].message.content;

    chatBox.innerHTML += `<p><b>${currentSuspect}:</b> ${answer}</p>`;
}
</script>

</body>
</html>
